# Instructions for Repetition of Study

This file describes how to reproduce the analysis of "Identification of the Mode of Evolution in Incomplete Carbonate Successions"

## Authors

__Niklas Hohmann__  
Utrecht University   
email: n.hohmann@uu.nl  
Web page: [uu.nl/staff/NHohmann](uu.nl/staff/NHohmann)  
Orcid: [0000-0003-1559-1838](https://orcid.org/0000-0003-1559-1838)

## Reproducibility

There are multiple ways to reproduce and repeat the study:

1. Full reproduction, where all data is generated anew from scratch
2. Inspection of the provided data
3. Reproduction of figures alone

Each point is described in a separate step, and can be performed independently

### 1. Full reproduction of data

#### 1. Get Age-Depth Models

##### 1.1 Generate Carbonate Platforms

1. Clone the "scenarioA" branch of the CarboCAT lite repository from [here](https://github.com/MindTheGap-ERC/CarboCATLite/tree/scenarioA).
2. Run the file "carbocatGUI.m" in Matlab
3. Click initialize in the GUI. The GUI after initialization is saved under "figs/matlab/scenarioA_initial_conditions.pdf" and serves as the basis for fig S1.
4. Click "Run CA model". This will start the model run, progress is displayed in the console.
5. Once the console outputs indicates the run is finished, save your workspace. The generated data is identical to the data saved under "data/matlab_output_scenarioA_matlab_outputs.mat". It constains all the raw data generated by CarboCAT.
5. Click "Plot run" to generate the chronostratigraphic chart and dip section saved under "figs/matlab/scenarioA_dip_section_and_chronostrat.pdf". This might take a while.

Repeat for the branch _scenarioB_ to generate the data for scenario B.

##### 1.2 Extract Age-Depth Models from CartboCAT

1. In the folder data -> matlab_outputs, run "get_adm_from_carbocat_outputs.m" in matlab. This generates the file "scenarioA_and_B_matlab_to_R.mat", which can be read into R.
2. Open RProj "CarbStratPalEvo"
3. Run _process_adm_from_matlab.R_ to import the ADMs into R. This will generate the file data/R_outputs/ageDepthModelsScenariosAandB.Rdata

#### Run analyses

Open the project "blblb" in Rstudio

### 2. Inspection of provided data

All produced data is in the folder _/data/_. For a detailed description of the data structure and contents see the file _/data/R_outputs/codebook.md_ (for outputs from R) and _/data/matlab_outputs/codebook.md_ (for outputs from matlab)

### 3. Reproduction of figures

To reproduce the figures in the main test and supplementary material, open the R project, and run

```{R}
source("code/make_plots.R")
```

This will use the data in _/data/R_outputs/_ to generate summary figures in the folder _/figs/R/_

NOTE: Only the figures displaying AIC weights make use of the test results stored in _/data/R_outputs/results_modes_of_evolution.Rdata_. All lineages are simulated anew when _make_plots_ is run. To make the plots reproducible, they can be seeded via the parameter _plot_seed_.  
This is a result of the study design. The tests simulate lineages at a specific basin position. Because trait values are random, this makes it impossible to compare __identical__ simulated lineages across multiple basin positions. This problem is circumvented in the functions used for plotting, see _/code/make_plots.R_ for details.

